<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ganti Kata Sandi</title>
    <link rel="stylesheet" href="/css/ubahpw-dosen.css">
     <style>
        .edit1 {
            position: relative;
        }
        
        .show-password-checkbox {
            position: absolute;
            top: 50%;
            right: 10px; /* Sesuaikan dengan kebutuhan */
            transform: translateY(-50%);
        }

        .show-password-label {
            display: none; /* Menghilangkan label */
        }

    </style>
</head>
<body>
        <form action="/profil/ubahpassword-dosen" method="POST">
                <div class="container">
                        <div class="edit1">
                                <label for="">NIP</label>
                                <input type="text" value="{{ nip }}" name="nip">

                                <label for="">Kata Sandi Lama</label>
                                <input type="password" id="oldPassword" name="oldPassword"   placeholder="Masukkan Kata Sandi Anda" required>
                                

                                <label for="">Kata Sandi Baru</label>
                                <input type="password" id="newPassword" name="newPassword"  placeholder="Masukkan Kata Sandi Baru" required>

                                <label for="">Konfirmasi Kata Sandi</label>
                                <input type="password" id="confirmPassword" name="confirmPassword"  placeholder="Masukkan Kata Sandi Baru" required>
                        </div>
            
                        <div class="tombol">
                                <button class="simpan" type="submit">SIMPAN</button>
                                <a href="/profil/profilDosen" class="kembali">Kembali</a>
                    
                        </div>
                </div>
        </form>

        <script>
        function togglePasswordVisibility(inputId) {
                const passwordInput = document.getElementById(inputId);
                const showPasswordCheckbox = document.getElementById(`show${inputId.charAt(0).toUpperCase() + inputId.slice(1)}`);
                
                if (showPasswordCheckbox.checked) {
                        passwordInput.type = 'text';
                } else {
                        passwordInput.type = 'password';
                }
        }

        // Menangani pengiriman form
                document.getElementById('changePasswordForm').addEventListener('submit', async function(event) {
                event.preventDefault(); // Menghentikan pengiriman form

        // Mengambil data form
                const username = document.getElementById('username').value;
                const oldPassword = document.getElementById('oldPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

        // Mengirim data form ke server menggunakan fetch API
                const response = await fetch('/change-password', {
                        method: 'POST',
                        headers: {
                        'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, oldPassword, newPassword, confirmPassword })
                });

        // Mengambil respons dari server dalam bentuk JSON
                const data = await response.json();

        // Memeriksa status respons
                if (!response.ok) {
                        // Jika respons tidak berhasil, menampilkan pesan kesalahan
                        document.getElementById('errorMessage').innerText = data.message;
                        document.getElementById('errorMessage').style.display = 'block'; // Menampilkan pesan kesalahan
                        // Mengosongkan input
                        document.getElementById('username').value = '';
                        document.getElementById('oldPassword').value = '';
                        document.getElementById('newPassword').value = '';
                        document.getElementById('confirmPassword').value = '';
                } else {
                        // Jika respons berhasil, melakukan sesuatu (misalnya, mereset form)
                        document.getElementById('errorMessage').style.display = 'none'; // Menyembunyikan pesan kesalahan jika ada
                        document.getElementById('changePasswordForm').reset(); // Mereset form
                }
        });
    </script>
</body>
</html>